require 'base64'
require 'zip'
require_relative 'base'

module QAT
	module Reporter
		class OpenTest
			module Publisher
				class Hosted < Base
					
					# Create a session in openTest
					# @see https://getopentest.org/reference/web-api.html#creating-a-test-session
					def create_session
						
						tests = tests.map { |test| { path: test[:path], name: test[:name] } }
						
						payload = {
							"actorTags":     actor_tags,
							"environment":   environment,
							"maxIterations": 1,
							"sessionLabel":  session_label,
							"tests":         tests
						}
						
						Client.new(base_url).post('/api/session', payload)
					end
					
					# Get session details by sessionID
					# @see https://getopentest.org/reference/web-api.html#getting-the-test-session-log
					def session_details
						Client.new(base_url).get("/api/session/#{session_id}")
					end
				end
			end
		end
	end
end